<form id="myForm">
    <label for="drawingCanvas">Sketch Here:</label>
    <canvas id="drawingCanvas" width="400" height="300" style="border:1px solid #000;"></canvas>
    <button type="submit">Submit</button>
    <BR>
    <button type="button" value="#f00">red</button>
    <button type="button" value="#0f0">green</button>
    <button type="button" value="#00f">blue</button>
    <button type="button" value="#000">black</button>
    <button type="button" value="#fff">white</button>
</form>


<script>
const canvas = document.getElementById('drawingCanvas');
const ctx = canvas.getContext('2d');

let drawing = false;

function startDrawing(e) {
    drawing = true;
    draw(e); // Start drawing right away on touch/click
}

function endDrawing() {
    drawing = false
    console.log("save now")
    ctx.beginPath(); // Reset path so the next line doesn't connect
}

function draw(e) {
    if (!drawing) return;

    // Get the position of the cursor relative to the canvas
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX || e.touches[0].clientX) - rect.left;
    const y = (e.clientY || e.touches[0].clientY) - rect.top;

    // Set drawing style
    ctx.lineWidth = 3;
    ctx.lineCap = 'round';
    ctx.strokeStyle = clr;

    // Draw a line to the current position
    ctx.lineTo(x, y);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x, y);
}

// Event listeners for both mouse and touch events
canvas.addEventListener('mousedown', startDrawing);
canvas.addEventListener('mouseup', endDrawing);
canvas.addEventListener('mousemove', draw);
canvas.addEventListener('touchstart', startDrawing);
canvas.addEventListener('touchend', endDrawing);
canvas.addEventListener('touchmove', draw);

let clr = "#000"

document.querySelectorAll("button[type=button]").forEach(btn=>{
    btn.addEventListener("click", e => {
        clr = e.target.getAttribute("value")
    })
})

document.getElementById('myForm').addEventListener('submit', function(e) {
    e.preventDefault(); // Prevents form from submitting right away

    const dataURL = canvas.toDataURL(); // Capture the canvas content as an image
    localStorage.setItem('savedSketch', dataURL);
});

const savedDataURL = localStorage.getItem('savedSketch')

if (savedDataURL) {
    const img = new Image();
    img.onload = function () {
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height); // Draw image onto the canvas
    };
    img.src = savedDataURL;
}

</script>